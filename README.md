# 💬 LLM 기반 턴제 게임: 인생 상담소

### 게임 개요
'인생 상담소'의 상담사가 되어, 총 5턴 동안 4명의 내담자를 상담하는 텍스트 기반 시뮬레이션 게임입니다.<br>
매 턴마다 한 명의 내담자를 선택하고, 그들의 고민에 대한 조언을 직접 입력합니다. <br>
LLM(내담자)은 플레이어의 조언을 바탕으로 감정적인 반응을 보이고, 조언의 적절성에 따라 '만족도' 점수가 변합니다.<br>

### 게임의 진행 순서
게임이 시작되면 플레이어(상담사)에게 4명의 내담자가 배정됩니다.
플레이어는 4명 중 1명을 선택해 상담을 시작합니다.
내담자의 현재 고민을 확인하고, 플레이어가 조언(상담 내용)을 텍스트로 입력합니다.
상담을 마친 후, 턴이 1 증가합니다.

### 점수 시스템
플레이어가 조언을 제출하면, 내담자(LLM)는 그 조언을 바탕으로 -5점에서 +5점 사이의 점수를 내부적으로 평가합니다.
이 점수는 해당 내담자의 **만족도**에 누적됩니다.
만족도가 높을수록 내담자는 더 깊은 고민을 털어놓거나 긍정적인 반응을 보입니다.

### 엔딩 조건
게임은 다음 두 가지 조건 중 하나가 충족되면 종료됩니다.

상담 완료 (만족): 특정 내담자의 '만족도'가 10점 이상이 되면, 해당 내담자는 만족하며 상담소를 떠납니다.

이 경우, '상담 완료' 목록에 추가되고 대기열에서 사라집니다.

아직 5턴이 끝나지 않았다면, 즉시 새로운 내담자가 대기열에 추가됩니다.

턴 종료: 총 5턴이 모두 소요되면 게임이 즉시 종료됩니다.

최종적으로 '상담 완료'에 성공한 내담자 목록과, 5턴이 끝날 때까지 '미완료' 상태로 남은 내담자 목록이 결과로 표시됩니다.

### 트러블슈팅 (개발 여정)
인생 상담소로 바꾸게 되었다. 기존 인생의 선택이라는 게임은 주인공에게 요구 사항을 만들고 그 요구사항을 턴별로 하나씩 들어주는 게임이었다. 하지만 이 게임은 주인공과 특정한 관계에 있는 사람들과 대화하는 구조의 게임이었는데, 이때 모델이 그러한 관계를 해석하지 못하고 역할을 혼동하는 경우가 많았다. 예를 들어 주인공이 범수, 아내가 다인이라면 다인이 어느샌가부터 범수인 듯 다인 자신에게 대답해야할 내용을 적는 경우가 생겼다. 그리고 주인공의 응답에 대한 답변으로 메세지 히스토리의 요약된 형태를 제출하는(예: Human: 나는 당신과 여행을 가고 싶어요) 경우가 있었다. 또한 자기 자신이라는 관계는 모델이 거의 해석하지 못하는 수준으로 요구사항을 만드는 경우가 많았다. 턴제에서 선택받지 못할 경우, 그 상황 또한 선택받지 못함을 전달하며 거기에서 감정의 부정적 반응을 생성하여 저장하려 했으나, 그것을 처리하는 과정이 어려운 건지 뜻하는대로 답이 나오지 않았고 이 때문인지 앞서 서술한 히스토리 제출 문제 같은 것이 있었다. 그래서 관계와 턴구조를 조금 더 가볍게 만들기 위해 그러한 정보를 덜 담을 수 있는 상담으로 전향하게 되었다.

기본적인 코드의 구조는 비슷한데, 턴제로 진행되고 객체를 class 인스턴스로 생성하여 메세지를 저장하는 구조로 두었다. 다만 미선택된 자들은 턴의 진행에서 정지되는 구조로, 그리고 상담자와 내담자는 특정 관계를 갖지 않게 만들었다. 결과적으로는 요구사항을 생성하는 것보다 상담 질문을 생성하는 능력이 훨씬 괜찮았다.

### 기술 스택
Python

Streamlit (Web UI)

Ollama (로컬 LLM 구동)

EEVE-Korean-10.8B (GGUF)

### 개발자 노트
생각 정리
게임에 LLM을 접목시킴으로써 얻을 수 있는 이점은 무엇일까.

트랜스포머를 활용한 기능 : 기계번역, 감정분석, 텍스트생성, NER, QnA, Fill-Mask, 요약, 특징 추출(사용처가 이후 요약이나 감정분석 혹은 유사도일 듯), 제로샷분류

LLM의 강점을 맥락 파악과 그럴싸한 이야기의 연결이라고 보았을 때, 구체적으로 정해지지 않은 입력을 통해 다양한 결과를 도출할 수 있는 게임이 좋을 것 같음. <- 이건 사실 텍스트 생성이라는 테스크로 한정시켜서 본 것일 수도 있다.

굳이 LLM 기능활용에 매몰되기보다 더 재밌는 게임에 대한 생각이 생기면 바꿔도 좋을 듯.

게임에 있어 중요한 것은 무엇일까.

재미, 이 게임이 재미가 있을까. 이건 고민해 봐야할 숙제, 서브 이벤트(게임 안의 게임 같은 거)를 도입하는 것도 고민해 봐야할 듯.

게임에도 다큐 영화와 같은 장르가 있으면 안 되나?

다른 아이디어 생각해 본 것들.

- 코딩 방탈출

- 베스킨 라빈스 31, 여러 명이 구성되는데 이때 똑똑이(생존 확률을 높이는 선택을 하는 애)와 안똑똑이(랜덤 선택을 하는 애)로 구성

- 영화 주연(혹은 조연)의 페르소나(외적 인격)를 가진 익명의 캐릭터와 대화를 하며 영화 제목 맞히기

- 영화속 등장인물을 선택하고 그 사람과 연애 시뮬레이션해서 점수 얻기

- 영화 조연의 시점으로 쓴 일기를 읽고 영화 제목 맞히기, 이건 재미 없을 듯.

- 보이지 않는 삶들 : 인생의 선택들에 대해 누적된 결과를 보여주는 게임 

구상(11/2, 05:54 시점)

진행

우선 한 인물의 배경이 설명 된다.

인물이 선택을 해야하는 인생의 시점(턴)들이 주어진다.

각 턴에는 우리가 선택해야만 하는 상황이 발생한다.

여기서 상황을 선택한 후 그 상황에 맞는 행동이나 말을 입력한다.

그러한 선택들은 이후의 시점에서 주어지는 상황을 변화시킨다.

그 변화된 상황 속에서 다시 선택의 시점이 주어진다

누적된 선택에 따른 결과를 보여준다.

키포인트 이후 주인공의 삶에서 조연으로 등장한 다른 인물을 골라 동일한 게임을 다시 진행하거나 멈춘다.

만약 2차 게임을 진행할 경우, 기존 인물의 선택에 따른 결과가 포함된 배경으로 새로운 게임이 시작된다.

세부 요소 턴 수 : 5회 선택해야 하는 상황 목록: '배우자 혹은 연인(사랑)' '자식 혹은 부모 혹은 형제자매(플라토닉 사랑)' '친구(우정)' '직장 혹은 학교 주변인(커리어 혹은 경제 관련)' '나 자신(건강)'] 선택의 결과 : 상황별 주인공의 현상황, 인물별 주인공에 대한 현재 호감도 및 생각 혹은 입장을 요약한다. 이때 선택받지 못한 사람과는 멀어지고 선택한 사람과는 풍부한 서사를 만들어 선택에 따른 결과에 대비감을 줄 수 있게 한다.

(11/2, 20:55)

프롬프트의 문제인지 원하는대로 나오지 않음. 프롬프트 프레임워크 있는 거 갖다 써보면 좋을 듯.

RTF : Role-Task-Format

TAG : Task-Action-Goal

BAB : Before-After-Bridge

CARE : Context-Action-Result-Example

RISE : Context-Action-Result-Example

(11/3, 22:32)

프롬프트의 프레임워크?인지 뭐시긴지를 도입하려다가 생각을 바꿨다. 그냥 프롬프트를 객체지향적으로 주는 것이 어떨까? 게임 진행에 따른 캐릭터를 모두 객체로 생성한 뒤 인스턴스 변수로 관계, 이름, 등을 만들어 그것에 따라 조금씩 다른 시스템프롬프트를 만들고, 이를 바탕으로 게임 진행에 따른 순서의 변경을 반복문으로 구현하여 인스턴스에 따라 서로 다른 메시지들을 저장하는 것이다.

예를 들어, 아내가 있다고 치자. 그럼 그녀는 객체다. Person이든 Player든, 그리고 그녀의 인스턴스 변수에는 그녀를 생성하며 주어준 정보들에 따른 프롬프트가 만들어진다. 그럼 그 프롬프트에 따라 챗을 돌리고 그녀에 관한 내용만 메세지 히스토리에 추가된다. 다른 사람들과 주인공의 관계까지는 알 필요가 없을 것 같고, 게임 진행에 있어 쪼개서 생각하는 것이 더 나을 것 같아 이렇게 생각했다.

진행자, 그리고 5가지의 상황에 따른 인물 이렇게 프롬프트가 필요한데 객체는 5개의 인물만 생성하고 진행자는 그냥 따로 프롬프트를 생성하면 될 것 같다. 물론 전체적으로 조망하는 게 좋으나 모델의 성능상 너무 많은 정보를 담기가 어려울 것 같아. 각각의 메세지를 따로 보관하는 게 좋을 것 같아 이렇게 구상하게 되었다.

### 회고
- 솔직히 모델의 성능이 원하는 만큼 따라주지 않아 흥미가 떨어지는 경우가 많았다. 혼자 프로젝트를 진행하며 무언가를 끝까지 완주하기 위해선 흥미보단 의지가 중요한 것 같다.
